# Mrežno programiranje

## URL

- URL : Universal Resource Locator (univerzalni lokator resursa) 

- sastoji se od mrežnog protokola ili scheme pomoću kojeg se pristupa resursu

<span style="color:red">
https:</span>
<span style="color:lime">//zamger.etf.unsa.ba
</span>
<span style="color:yellow">/index.php</span>
<span style="color:cyan">?sta=izvjestaj/predmet&predmet=9&ag=14&...</span>


- URL se sastoji od sljedećih dijelova, od čega su samo prva dva obavezni:
1. <span style="color:red">mrežnog protokola</span> ili šeme pomoću kojeg se pristupa resursu (http, https, ftp…), 
znaka dvotačka,
2. oznake <span style="color:lime">autoriteta</span>(eng. authority) koja predstavlja domensko ime servera, a počinje znakovima //
3. <span style="color:yellow">putanje</span> (puta, eng. path) do resursa, koja može (ali ne mora) počinjati znakom /
4. <span style="color:cyan">upita</span> (eng. query) koji predstavlja podatke koji se šalju kao parametri web lokaciji, pri čemu su podaci razdvojeni znakom &, a u formatu su ključ=vrijednost; upit počinje znakom ?
5. <span style="color:purple">fragment</span> koji počinje znakom # a predstavlja najčešće informacije za klijenta koje nisu relevantne serveru (ali ih on svejedno dobija).

- klasa URL omogućuje da se provjeri da li string predstavlja validan URL
- ako nije baca izuzetak MalformedURLException kao npr.

```java
Scanner scanner = new Scanner(System.in);
String adresa = scanner.nextLine();
try {
            URL url = new URL(adresa);
            System.out.println("URL je ok, protokol " + url.getProtocol() + 
						", autoritet " + url.getAuthority());
} catch (MalformedURLException e) {
            System.out.println("String "+adresa+" ne predstavlja validan URL");
}
```
## Preuzimanje podataka sa interneta + primjer korištenja

- klasa posjeduje metodu openStream() koja otvara InputStream prema datom resursu
- ovaj primjer će skinuti sav sadržaj sa etf stranice i spasiti u string

```java
URL url = new URL("http://www.etf.unsa.ba");
	BufferedReader ulaz = new BufferedReader(new InputStreamReader(url.openStream(),
			StandardCharsets.UTF_8));
	String sadrzaj = "", line = null;
	while ((line = ulaz.readLine()) != null)
		sadrzaj = sadrzaj + line;
```
- nisu podržane metode PUT, POST, DELETE, ne mogu se definisati header polja itd.

## JSON

- za Web API najčešće koriste XML, JSON i YAML
- najpopularniji format
- JavaScript Object Notation
- pokušaj da se instance objekata zapišu u tekstualni fajl
  
- **{}** označavaju objekat, dok **[]** niz.
- unutar toga se mogu nalaziti drugi objekti/nizovi u formatu kao kod mape (ključ:vrijednost)
- svi čanovi objekta su odvojeni zarezom
- na vrhu se nalazi bezimeni objekat

npr. 
```json
{
		"stanovnika": 3500000,
		"naziv": "Bosna i Hercegovina",
		"glavnigrad": {
			"stanovnika": "400000",
			"naziv": "Sarajevo"
		},
		"povrsina": {
			"jedinica": "km2",
			"vrijednost": "51129"
		},
		"moneta": "KM"
	}
```
## JSON biblioteke

- najpopularnije: GSON, org.json i Jackson
- klasa JSONObject ima getString, getInt, ..., getJSONObject, getJSONArray

## HttpURLConnection

- za složenije API-je se koristi, ima više opcija
```java
URL url = new URL("https://aws.random.cat/meow");
	HttpURLConnection con = (HttpURLConnection)url.openConnection();
// Postavljanje HTTP metode vršimo funkcijom setRequestMethod:
	con.setRequestMethod("POST");
// Postavljanje polja zaglavlja vršimo metodom setRequestProperty. Za API-je koji koriste JSON u pravilu treba postaviti polja Content-Type i Accept na vrijednost application/json:
	con.setRequestProperty("Content-Type", "application/json; utf-8");
	con.setRequestProperty("Accept", "application/json");

```
- Kod vrlo jednostavnih API-ja parametri se šalju u sklopu samog URLa (kroz "upit"). Međutim, polje za upit nije dovoljno fleksibilno i ograničena je njegova veličina. 
- Mnogi REST API-ji zahtijevaju da se vrijednost pošalju u tijelu zahtjeva (request body) i da budu JSON kodirani.

- čitanje sadržaja :

```java
BufferedReader ulaz = new BufferedReader(new InputStreamReader(con.getInputStream(),
			StandardCharsets.UTF_8));
	String json = "", line = null;
	while ((line = ulaz.readLine()) != null)
		json = json + line;
	JSONObject jsonObject = new JSONObject(json);
	...

```

## Klijent-server komunikacija

- Java aplikacije se mogu koristiti za klasičnu mrežnu komunikaciju po vlastitom protokolu, pri čemu vaša aplikacija može igratu ulogu klijenta ili servera. Ovo se postiže klasom **Socket**.
Primjer klijenta:
```java
String adresa = "192.168.1.8";
	int port = 2345;
	try {
		Socket konekcija = new Socket(adresa, port);
		InputStream ulaz = konekcija.getInputStream();
		OutputStream izlaz = konekcija.getOutputStream();
		...
		konekcija.close();
	} catch (IOException e) {
		...
	}
```

Primjer servera:
```java
int port = 2345;
	try {
		ServerSocket server = new ServerSocket(port);
		while (true) {
			Socket konekcija = server.accept();
			InputStream ulaz = konekcija.getInputStream();
			OutputStream izlaz = konekcija.getOutputStream();
			...
			konekcija.close();
		}
	} catch (IOException e) {
		...
	}
```
